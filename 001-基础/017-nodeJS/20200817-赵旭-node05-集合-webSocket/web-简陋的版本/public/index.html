<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èŠå¤©å®¤</title>
</head>
<body>

    <div id="room">
        <ul>
            <li class="me">
                <div class="wellcome"></div>
                <div class="time"></div>
                <div class="say"></div>
            </li>
        </ul>
    </div>

    <textarea name="" id="textarea" cols="60" rows="10"></textarea>
    <input type="text" id="content">
    <button id="btn">å‘é€</button>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>

        let textarea = document.querySelector('#textarea');
        let content = document.querySelector('#content');
        let btn = document.querySelector('#btn');

        let me = '';
        
        // 1- é€šè¿‡httpè¯·æ±‚ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘è¦ä½¿ç”¨wsåè®®äº†ï¼Œå› ä¸ºwsåè®®æ˜¯æ ¹æ®å·²æœ‰çš„httpåè®®å‡çº§è€Œæˆçš„
        const socket = io('/');
        socket.on('hello', data => {
            let obj = JSON.parse(data);
            // console.log(obj);
            if(me === ''){
                me = obj.id;
                writeData(`${obj.time} - æ¬¢è¿æ‚¨ ${me}`);
            }else{
                // æœ‰æ–°çš„æœ‹å‹åŠ å…¥ ${socket.id}ï¼Œæˆ‘ä»¬æ¬¢è¿ï¼ğŸ‘ä»–
                writeData(`${obj.time} - æœ‰æ–°çš„æœ‹å‹åŠ å…¥ ${obj.id}ï¼Œæˆ‘ä»¬æ¬¢è¿ï¼ğŸ‘ä»–`);
            }
        })

        socket.on('message', data => {
            // console.log('message-->', data);

            let str = '';
            let obj = JSON.parse(data);
            // console.log(obj);

            if(obj.id  == me){
                str = obj.time + '  æˆ‘è¯´  ' + obj.str;
                writeData(str);
                // textarea.innerHTML += str + '\r\n';
            }else{
                str = obj.time + obj.id + '  è¯´ï¼š' + obj.str;
                writeData(str);
                // textarea.innerHTML += str + '\r\n';
            }
        })

        socket.on('userUpdate', data => {
            console.log(data)
        })


        btn.onclick = function() {
            // writeData('æˆ‘è¯´ï¼š' + content.value);
            socket.emit('message', content.value);
            content.value = '';
            content.focus();
        }

        function writeData(data) {
            textarea.innerHTML += data + '\r\n';
        }

    </script>

</body>
</html>